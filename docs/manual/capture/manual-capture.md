# 記録ツール 操作説明書

記録ツールはテスト対象サイト上で行われたユーザー操作を記録するツールです。
本ツールは以下の画面から構成されます。

- [ヘッダー](#ヘッダー)
  - [URL 入力欄](#url-入力欄)
  - [テスト結果名入力欄](#テスト結果名入力欄)
  - [テスト開始/終了ボタン](#テスト開始終了ボタン)
  - [操作記録の一時停止/再開ボタン](#操作記録の一時停止再開ボタン)
  - [履歴リセットボタン](#履歴リセットボタン)
  - [テスト結果インポートボタン](#テスト結果インポートボタン)
  - [履歴再生開始/中止ボタン](#履歴再生開始中止ボタン)
  - [locale](#locale)
- [フッター](#フッター)
  - [ブラウザバック・フォワードボタン](#ブラウザバックフォワードボタン)
  - [タブ・ウィンドウ切り替えボタン](#タブウィンドウ切り替えボタン)
  - [メモボタン](#メモボタン)
  - [画面切り替えボタン](#画面切り替えボタン)
  - [経過時間](#経過時間)
- [設定画面](#設定画面)
  - [テスト対象設定](#テスト対象設定)
  - [デバイスの詳細設定](#デバイスの詳細設定)
  - [画像圧縮設定](#画像圧縮設定)
  - [画面要素カバレッジの設定](#画面要素カバレッジの設定)
  - [画面遷移の定義](#画面遷移の定義)
- [履歴画面](#履歴画面)
  - [モデル・カバレッジ更新ボタン](#モデルカバレッジ更新ボタン)
  - [スクリプト生成ボタン](#スクリプト生成ボタン)
  - [シーケンス図モデル](#シーケンス図モデル)
  - [画面遷移図モデル](#画面遷移図モデル)
  - [画面要素カバレッジ](#画面要素カバレッジ)

# ヘッダー

<img src="./images/header.png"/>

テストの開始や終了、既存のテスト結果のインポート、記録した操作のリプレイなどを行うことができます。

## URL 入力欄

<img src="./images/url.png"/>

テスト対象サイトの URL を入力する欄です。

## テスト結果名入力欄

<img src="./images/test-result-name.png"/>

テスト結果の名称を入力する欄です。
任意の名称を付与することができ、未記入の場合は自動的に付与されます。

## テスト開始/終了ボタン

<img src="./images/start-recording.png"/>
<img src="./images/end-recording.png"/>

「URL 入力欄」に有効な URL を入力すると活性化され、押下すると以下のダイアログからテスト目的を使用してテストをするか、その場合最初のテスト目的はどうするかといった設定を入力することができます。

:bulb: アドホックテスト等、特にテスト目的を決めずにテストを進めたい場合はチェックボックスを OFF にして始めることもできます。

<img src="./images/start-testing.png" width="400px" />

ダイアログの「OK」ボタンを押下するとブラウザが立ち上がり、「URL 入力欄」で入力された URL のページを表示し、記録が開始されます。

:bulb: 操作内容は`latteart-repository/public/test-results/`配下のディレクトリに保存されます。

:warning: LatteArt での記録中に画面遷移等で新しいページを開く際、ページが読み込まれる前に操作をすると LatteArt が正しく記録できない場合があります。完全にページがロードされてから操作するようにしてください。

記録開始後に再度押下するとブラウザが閉じ、記録が終了されます。

## 操作記録の一時停止/再開ボタン

<img src="./images/pause-recording.png"/>
<img src="./images/resume-recording.png"/>

テスト中に押下すると、LatteArt での操作記録を一時停止します。
記録の停止中は、テスト対象サイト上でクリックやテキスト入力等の入力操作を行っても LatteArt に記録されません。
停止中に再度押下すると、停止状態が解除され、以降の操作は通常通り LatteArt に記録されるようになります。

:bulb: テスト対象サイトによっては、LatteArt での記録中に画面要素を操作しても正しく動作しない場合がございます（クリックが反応しない等）。その場合は回避策として本機能をご利用ください。

:warning: テスト中に記録の一時停止を行った操作履歴は、「履歴再生」機能や「スクリプト生成」機能で利用した際に、正しく動作しない場合があります。

## 履歴リセットボタン

<img src="./images/reset.png"/>

押下すると記録されているテスト履歴をクリアします。テストを最初から行いたい場合等に使用してください。

:bulb: 過去のテスト結果は保存されているため、誤ってリセットしてしまった場合は、「テスト結果インポートボタン」により復元できます。

## テスト結果インポートボタン

<img src="./images/import.png"/>

押下すると保存されているテスト結果名の一覧が表示され、選択したテスト結果を読み込むことができます。
読み込んだテスト結果は再度「テスト開始ボタン」を押下することで、セッションの続きからテストを行うことができます。

## 履歴再生開始/中止ボタン

<img src="./images/start-running.png"/>
<img src="./images/stop-running.png"/>

押下するとブラウザが立ち上がり、操作のタイミング含め、記録された操作がそのまま自動的に繰り返されます。
再生開始後に再度押下するとブラウザが閉じ、再生が中止されます。

## locale

<img src="./images/locale.png"/>

表示言語を切り替えることができます。

- ja（日本語）
- en（英語）

# フッター

<img src="./images/footer.png"/>

主に、記録中におけるコメントの付与やテスト対象ブラウザへの一部の操作を行うことができます。

## ブラウザバック・フォワードボタン

<img src="./images/browser-back-forward.png"/>

テスト中に押下すると、テスト対象ブラウザ上で「戻る」・「進む」が実行され、LatteArt に操作として記録されます。

:warning: 本ボタンを使わずに、ブラウザの「戻る」・「進む」をボタンを直接使用した場合、「戻る」・「進む」といった操作は記録されません。テスト中はテスト対象ブラウザの「戻る」・「進む」ボタンは使用せずに本ボタンを使用してください。

:warning: テスト対象サイト側でブラウザの「戻る」・「進む」機能を呼び出すというような実装がされている場合、LatteArt 側で管理している情報と正しく連動できなくなり、本ボタンの状態がおかしくなる場合があります。そのような実装がされている場合は、該当箇所の操作と本ボタンでの操作（ブラウザバック・フォワードの記録）は併用しないてください。

## タブ・ウィンドウ切り替えボタン

<img src="./images/select-window.png"/>

テスト中に押下するとダイアログが表示され、記録対象のタブ・ウィンドウを切り替えることができます。
タブ・ウィンドウは検出された順に`window1`、`window2`という形で通番が振られて表示されます。

:warning: テスト対象ブラウザ上でアクティブなタブ・ウィンドウを切り替えた場合、LatteArt は自動的に新しくアクティブとなったタブ・ウィンドウを記録対象と認識しますが、ドメインの異なる画面を開いている他タブ・ウインドウに対しては自動的に切り替わりません。
その場合は、本ボタンを使用して記録対象タブ・ウィンドウを手動で切り替えてください。

:warning: タブ・ウィンドウ切り替えダイアログは、本ボタン押下時以外に、別タブ・ウインドウが新しく開かれた際にも自動的に開かれます。

:warning: 非アクティブなタブ・ウィンドウは薄暗く表示され、クリックなどの操作を受け付けません。

## メモボタン

<img src="./images/add-note-button.png"/>

テスト開始時に**テスト目的を使用する**ように設定した場合は、テスト中に本ボタンを押下すると以下のダイアログが表示され、メモを残すことができます。
メモではテスト目的に従ってテストした際の結果や次に行うテスト目的を入力することができます。

:bulb: 記録したメモの編集・削除はシーケンス図、操作一覧からできます。

<img src="./images/add-note.png" width="400px" />

メモにてテスト中の気づきを記録する際、タグを付与することができます。
タグはあらかじめ用意されているものの他、任意の文字列を入力して付与することもできます。

<img src="./images/add-tag.png" width="400px" />

テスト開始時に**テスト目的を使用しない**ように設定した場合は、テスト中の気づきのみを入力できる以下のダイアログが表示されます。

<img src="./images/add-notice.png" width="400px" />

## 画面切り替えボタン

押下すると現在表示中の記録ツールの画面を切り替えることができます。

- [設定画面](#設定画面)に切り替える
  <img src="./images/switch-to-config.png"/>

- [履歴画面](#履歴画面)に切り替える
  <img src="./images/switch-to-history.png"/>

## 経過時間

<img src="./images/time.png"/>

テスト開始からの経過時間が表示されます。

## 設定画面

<img src="./images/config-view.png"/>

テスト対象の設定や記録された操作群を可視化する際の表示設定を行えます。
各種設定は変更時にリアルタイムで保存されます。

## テスト対象設定

<img src="./images/test-target-config.png"/>

テスト対象の設定を行うことができます。

- プラットフォーム
  - テスト対象プラットフォームを指定する欄です。
- ブラウザ
  - テスト対象ブラウザを指定する欄です。
- ブラウザ起動時にリロードする
  - 記録開始後自動的にブラウザをリロードする秒数を指定する欄です。リロードさせない場合は 0 秒を指定してください。
  - :bulb: モバイル端末に対するテスト等で Chrome DevTools のリモートデバッグ機能を用いる際、接続された端末のブラウザ起動のタイミングによってはデバイスの認識が遅れ、ページを正しく表示できない場合があります。
    その場合はデバイスが認識される秒数の後にリロードされるように本設定値で指定することで正しいページを表示させることができます。

## デバイスの詳細設定

<img src="./images/device-config.png"/>

USB で接続されているデバイスを選択することができます。
「テスト対象設定」の「プラットフォーム」欄で`Android`もしくは`iOS`を選択した場合に活性化されます。

- デバイス情報更新
  - 押下すると接続されているデバイスが再検索されます。
  - :bulb: 設定画面を開いた後にデバイスを接続した場合は情報が最新化されていない可能性があります。その場合は本ボタンを押下して最新の情報を取得してください。
- デバイス選択
  - 接続されているデバイスが複数存在する場合に、テスト対象のデバイスを選択することができます。
- OS バージョン
  - 選択されたテスト対象のデバイスの OS バージョンが表示されます。

## 画像圧縮設定

<img src="./images/compression-config.png"/>

スクリーンショットの画像の圧縮設定を行うことができます。

- 取得したスクリーンショットを圧縮する
  - ON にすると、取得したスクリーンショットを圧縮してリポジトリに保存するようになります。ディスク容量を節約したい場合に有効です。
- 元画像を削除する
  - ON にすると、スクリーンショットを圧縮する際に圧縮前のオリジナルデータを削除します。圧縮前のオリジナルデータもバックアップとして残しておきたい場合は OFF にしてください。

:warning: 続けて素早く操作を行う、もしくは CPU に高負荷がかかっている状態だと画像の圧縮に失敗することがあります。

## 画面要素カバレッジの設定

<img src="./images/coverage-config.png"/>

画面要素カバレッジに関する設定を行うことができます。

- カバレッジ計算に含めるタグ
  - 画面要素カバレッジの計算に含めるタグを指定することができます。

## 画面遷移の定義

<img src="./images/screen-config.png"/>

履歴画面での各種モデルで「画面」として認識する粒度を設定することができます。

### デフォルト画面定義

ページタイトルで画面を認識するか、URL で画面を認識するかを選択します。

- タイトルで画面遷移を判断する。
  - ON にすると、履歴画面の各種モデルでページタイトルの同じ画面が同一画面としてまとめられるようになります。
- URL で画面遷移を判断する。
  - ON にすると、履歴画面の各種モデルで URL の同じ画面が同一画面としてまとめられるようになります。

### 優先条件

優先的に使用する画面定義で、デフォルト画面定義よりも優先されます。
特定の条件を満たす画面のみ例外的に別の画面と認識させたい場合は本設定にて詳細な設定を行ってください。
優先条件は最上位から順にマッチしたものがまとめられます。

- 追加ボタン
  - 優先的に使用する画面定義を追加します。
- 有効/無効（優先条件） チェックボックス
  - ON にすると、優先条件が有効になります。
- 定義名
  - 詳細条件をすべて満たすと同一画面としてまとめられ、「定義名」で指定した画面名に置き換えられます。
- 定義削除ボタン
  - 定義を削除します。
- 詳細条件を追加するボタン
  - 詳細条件を追加します。
- 詳細条件
  - 有効/無効（詳細条件）チェックボックス
    - ON にすると、該当行の詳細条件が有効になります。
  - 詳細条件（マッチ種別・テキスト・マッチ方法）
    - 指定されたテキストがマッチ種別で選択した「URL/タイトル/キーワード」に、マッチ方法で選択した「文字列が含まれている/文字列と一致している/正規表現がマッチしている」でマッチしているか判定します。
  - 詳細条件削除ボタン
    - 該当行の詳細条件を削除します。詳細条件が 2 行以上存在する場合のみ表示されます。詳細条件を全て削除したい場合は定義を削除してください。

# 履歴画面

<img src="./images/history-view.png"/>

記録された操作郡の履歴、及び可視化されたモデルを確認できます。

## モデル・カバレッジ更新ボタン

<img src="./images/update-models.png"/>

操作履歴や設定が更新された場合に活性化され、押下すると「シーケンス図モデル」、「画面遷移図モデル」、「画面要素カバレッジ」の表示が最新化されます。

## スクリプト生成ボタン

<img src="./images/generate-test-scripts.png"/>

テスト結果の内容を元に、スモークテスト向けの End-to-End テストスクリプトとして、ページオブジェクト（page_objects）、テストケース（test.spec.js）、テストデータ（test_data）の一式が生成されます。
ページオブジェクトは「画面遷移の定義」で定められた画面と一対一で対応します。

以下のオプションが設定可能です。

- データ駆動方式を使用する
  - チェックを入れると、 `test_data/TestData.js` に定義されたデータを入力値とするテストを生成します。
  - チェックを入れない場合、`test.spec.js` に入力値が埋め込まれます。
- 最大数
  - 画面ごとに生成されるテストデータの最大数を指定します。`0` を指定した場合は、具体的な値は生成されず雛形のみが生成されます。

また、`doc/index.html` にJSDocを用いたテストスクリプトの説明書が生成されます。
各ページオブジェクトとテストケースが画面遷移図やスクリーンショットを用いて可視化されます。
## シーケンス図モデル

<img src="./images/sequence-diagram-model.png"/>

テストの流れとテスト中に記録されたメモ（テスト目的、テスト中の気づき）を確認することができます。

### シーケンス図

<img src="./images/sequence-diagram.png"/>

テストの大まかな流れと記録した以下情報を可視化したシーケンス図が表示されます。

- 画面
  - 図内にアクター（図上部の四角）として表示されます。
  - クリックすると対応する操作のスクリーンショットが画面右上の表示領域に表示され、画面下部の「操作一覧」の表示が関連する操作のみに絞り込まれます。
- ウィンドウ
  - 図内に枠として表示されます。ウィンドウ枠のテキストには、`window1`や`window2`といったウィンドウ名が表示されます。
- 画面で行われた操作群
  - 図内にアクティベーションボックス（縦長の細い四角）で表示されます。
  - クリックすると対応する操作のスクリーンショットが画面右上の表示領域に表示され、画面下部の「操作一覧」の表示が該当箇所で行われた操作群のみに絞り込まれます。
- 画面遷移
  - 図内に矢印として表示されます。
  - テキストをクリックすると対応する操作のスクリーンショットが画面右上の表示領域に表示され、画面下部の「操作一覧」の表示が遷移元画面で行われた操作群のみに絞り込まれます。
- テスト目的
  - 図内に枠として表示されます。
  - 枠のテキストを右クリックすることで、メモの編集（内容の修正、紐づけ先の操作の変更）・削除を行うことができます。
- テスト中の気付き
  - 図内に四角として表示されます。
    - `bug`タグが付与されている場合は赤色、それ以外は紫色で表示されます。
  - クリックすると対応する操作のスクリーンショットが画面右上の表示領域に表示され、画面下部の「操作一覧」の表示が関連する操作のみに絞り込まれます。
  - 右クリックすることで、メモの編集（内容の修正、紐づけ先の操作の変更）・削除を行うことができます。

図左上の+/-ボタンで図の拡大/縮小が行えます。
図内の「（数字）」は記録された操作の通番を意味します。

### フィルタリセットボタン

<img src="./images/filter-reset.png"/>

シーケンス図の操作により絞り込まれた操作一覧の表示を元に戻します。

### 操作一覧

<img src="./images/operation-list.png"/>

テスト中に記録された操作履歴の以下情報がテーブルとして表示されます。

- 通番
  - テストを行った順番が表示されます。
- ページタイトル
  - 操作が行われた画面のタイトルが表示されます。
- 要素タグ
  - 操作が行われた画面要素のタグが表示されます。
- 要素名
  - 操作が行われた画面要素の名前が表示されます。
- テキスト
  - 操作が行われた画面要素の表示文字列が表示されます。
- イベント種別
  - 操作により発火されるイベントの種別が表示されます。また、通常のイベントの他に LatteArt 独自の以下イベント種別も表示されます。
    - `screen_transition`
      - 画面遷移を検出したことを意味します。
    - `switch_window`
      - タブ・ウィンドウ切り替えが行われたことを意味します。
    - `browser_back`
      - 記録ツールにて指示されたブラウザバックが行わえたことを意味します。
    - `browser_forward`
      - 記録ツールにて指示されたブラウザフォワードが行われたことを意味します。
- 入力値
  - 操作にて入力された値が表示されます。
- 時刻
  - 操作を行った時刻が表示されます。

各行が 1 操作に対応し、操作に関連する画面要素の情報や入力値を確認することができ、各行をクリックすると、対応する操作のスクリーンショットが画面右上の表示領域に表示されます。
また、テーブルの見出しをクリックすることでソート（昇順/降順/記録順）、テーブル下部で一度に表示される行数の変更や改ページを行うことができます。

### 検索ワード入力欄

<img src="./images/text-search.png"/>

任意の文字列を入力すると、「操作一覧」のテーブルを指定の文字列を含む行のみに絞り込むことができます。

:warning: 本入力欄による絞り込みは「フィルタリセットボタン」を押下してもリセットされません。本入力欄での絞り込みをリセットしたい場合は入力欄を空にしてください。

## 画面遷移図モデル

テスト中に到達した画面と各画面遷移時の情報を確認することができます。

<img src="./images/screen-transition-diagram-model.png"/>

### 画面遷移図

<img src="./images/screen-transition-diagram.png"/>

テスト中に記録した以下情報を可視化した画面遷移図が表示されます。
図は記録されたウィンドウ毎に生成され、「対象タブ/ウィンドウ」で表示する図を選択することができます。

- 画面
  - 図内に四角として表示されます。
  - クリックすると対応する操作のスクリーンショットが画面右上の表示領域に表示され、画面下部の「入力値一覧」にクリックした画面から遷移する全ての画面遷移群の入力値情報が表示されます。
- 遷移契機
  - 図内に矢印として表示されます。
  - テキストをクリックすると対応する操作のスクリーンショットが画面右上の表示領域に表示され、画面下部の「入力値一覧」にクリックした画面遷移の入力値情報が表示されます。

図左上の+/-ボタンで図の拡大/縮小が行えます。

### 入力値一覧

<img src="./images/input-value-list.png"/>

画面遷移時、その画面の各画面要素に入力されている値のセットをテーブルで表示します。

各行は 1 画面要素に対応し、各画面遷移時における各画面要素に入力されていた値を確認することができ、各行をクリックすると、対応する画面要素のスクリーンショットが画面右上の表示領域に表示されます。
同一画面遷移が複数回行われた場合は、それぞれの画面遷移時の入力値群が列として表示されます。
また、テーブル下部で一度に表示される行数の変更や改ページを行うことができます。

入力値一覧の表示は以下のチェックボックスにより、カスタマイズすることができます。

- 明示的に入力された値以外をグレーアウトする
  - 本チェックボックスを ON にすると、テスト中の操作にて明示的に入力された値以外（デフォルト値等の元々画面要素に入っていた値）のセルをグレーアウトして表示します。
- hidden 要素は表示しない
  - ON にすると入力値一覧から hidden 要素が非表示になります。

## 画面要素カバレッジ

<img src="./images/coverage-model.png"/>

テスト中に到達した各画面内における、画面要素の操作網羅率を確認することができます。

:bulb: カバレッジの計算対象に含めるタグは設定画面にてカスタマイズできます。

各画面名をクリックすると、画面内の画面要素一覧が表示され、一度も操作されていない画面要素は赤色、操作済の画面要素は緑色の行として表示されます。
